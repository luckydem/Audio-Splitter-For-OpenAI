{
  "name": "Audio Transcription Workflow v2",
  "nodes": [
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1VK53SB0fOp7cqfbOrILlQPFsbQEahW68",
          "mode": "id"
        },
        "event": "fileCreated",
        "options": {}
      },
      "id": "9e066b44-7379-4bc8-980c-12e866ed6a43",
      "name": "Google Drive Trigger",
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        80,
        100
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "3N3wNqDb70k6SYyp",
          "name": "Google Drive - CWS"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://audio-splitter-453383149276.us-central1.run.app/process-drive-file",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"drive_file_id\": \"{{ $json.id }}\",\n  \"max_size_mb\": 25,\n  \"output_format\": \"m4a\",\n  \"quality\": \"medium\",\n  \"openai_api_key\": \"**REMOVED_API_KEY**",\n  \"webhook_url\": \"{{ $execution.resumeUrl }}\"\n}",
        "options": {}
      },
      "id": "072fdf42-55e5-4bfe-9407-d69512a0af9d",
      "name": "Process & Transcribe Audio",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        280,
        100
      ]
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "job_id",
              "value": "={{ $json.job_id }}"
            },
            {
              "name": "processing_method",
              "value": "={{ $json.processing_method }}"
            },
            {
              "name": "estimated_time",
              "value": "={{ $json.estimated_processing_time_seconds }}"
            },
            {
              "name": "original_file_id",
              "value": "={{ $('Google Drive Trigger').item.json.id }}"
            },
            {
              "name": "original_file_name",
              "value": "={{ $('Google Drive Trigger').item.json.name }}"
            }
          ]
        },
        "options": {}
      },
      "id": "store-job-info",
      "name": "Store Job Info",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3,
      "position": [
        480,
        100
      ]
    },
    {
      "parameters": {
        "resume": "webhook",
        "limit": true,
        "limitType": "afterTimeInterval",
        "amount": 10,
        "unit": "minutes",
        "options": {
          "webhookSuffix": "transcription-complete"
        }
      },
      "id": "a57f555d-f30e-4e6d-a56e-04a8cff50602",
      "name": "Wait for Transcription",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        680,
        100
      ],
      "webhookId": "transcription-complete"
    },
    {
      "parameters": {
        "jsCode": "// Extract transcription text from webhook response\nconst transcriptionText = $json.transcription_text || '[No transcription available]';\nconst fileName = $('Store Job Info').item.json.original_file_name.replace(/\\.[^/.]+$/, '') + '_transcript.txt';\n\n// Create file content with metadata\nconst fileContent = `Transcription of: ${$('Store Job Info').item.json.original_file_name}\nProcessed on: ${new Date().toISOString()}\nJob ID: ${$json.job_id}\nProcessing Method: ${$json.processing_method}\nDuration: ${$json.total_duration_seconds} seconds\nProcessing Time: ${$json.processing_time_seconds} seconds\n\n${'='.repeat(80)}\n\n${transcriptionText}`;\n\nreturn {\n  fileName: fileName,\n  fileContent: fileContent,\n  transcriptionUrl: $json.transcription_url\n};"
      },
      "id": "format-transcription",
      "name": "Format Transcription",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        880,
        100
      ]
    },
    {
      "parameters": {
        "operation": "uploadText",
        "name": "={{ $json.fileName }}",
        "content": "={{ $json.fileContent }}",
        "driveId": {
          "__rl": true,
          "value": "0AGr_SUpzDIYvUk9PVA",
          "mode": "list",
          "cachedResultName": "CWS - Antoinette: Board of Directors",
          "cachedResultUrl": "https://drive.google.com/drive/folders/0AGr_SUpzDIYvUk9PVA"
        },
        "folderId": {
          "__rl": true,
          "value": "1Yei83415nIxPGK1g4IGzMH_Zxfs5rkhh",
          "mode": "list",
          "cachedResultName": "02 Meeting Transcriptions & Minutes",
          "cachedResultUrl": "https://drive.google.com/drive/folders/1Yei83415nIxPGK1g4IGzMH_Zxfs5rkhh"
        },
        "options": {}
      },
      "id": "cf3284ff-d00c-4c4d-b82d-e0355af254b7",
      "name": "Upload Transcription to Drive",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        1080,
        100
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "3N3wNqDb70k6SYyp",
          "name": "Google Drive - CWS"
        }
      }
    },
    {
      "parameters": {
        "operation": "move",
        "fileId": {
          "__rl": true,
          "value": "={{ $('Store Job Info').item.json.original_file_id }}",
          "mode": "id"
        },
        "driveId": {
          "__rl": true,
          "value": "My Drive",
          "mode": "list"
        },
        "folderId": {
          "__rl": true,
          "value": "YOUR_PROCESSED_FOLDER_ID",
          "mode": "id"
        }
      },
      "id": "b1f3e2a5-815e-4ef3-b54e-94fea75d2b70",
      "name": "Move to Processed Folder",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        1280,
        100
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "RQuBCj1GFf6GBuI0",
          "name": "Google Drive - Demian"
        }
      }
    }
  ],
  "connections": {
    "Google Drive Trigger": {
      "main": [
        [
          {
            "node": "Process & Transcribe Audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process & Transcribe Audio": {
      "main": [
        [
          {
            "node": "Store Job Info",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Store Job Info": {
      "main": [
        [
          {
            "node": "Wait for Transcription",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait for Transcription": {
      "main": [
        [
          {
            "node": "Format Transcription",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Transcription": {
      "main": [
        [
          {
            "node": "Upload Transcription to Drive",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload Transcription to Drive": {
      "main": [
        [
          {
            "node": "Move to Processed Folder",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "2e25e185c9c6d0b4f95f4faceb0e29ae93c025a57dd03c60d5700bc694f10040"
  }
}